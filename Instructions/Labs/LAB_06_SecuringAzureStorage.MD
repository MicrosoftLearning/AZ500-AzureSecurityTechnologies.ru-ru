---
lab:
  title: ' 06. Конечные точки службы и защита хранилища'
  module: Module 03 - Plan and implement security for Azure SQL Database and Azure SQL Managed Instance
---

# Лаборатория 06. Конечные точки службы и защита хранилища
# Руководство по лаборатории учащихся

## Сценарий практической работы

Вам было предложено создать доказательство концепции для демонстрации защиты общих папок Azure. В частности, вы хотите:
    
- Создайте конечную точку хранилища, чтобы трафик, предназначенный для служба хранилища Azure всегда остается в магистральной сети Azure.
- Настройте конечную точку хранилища, чтобы доступ к хранилищу могли получить только ресурсы из определенной подсети.
- Убедитесь, что ресурсы за пределами определенной подсети не могут получить доступ к хранилищу. 

> Для всех ресурсов в этой лаборатории мы используем **регион "Восточная часть США** ". Убедитесь, что этот регион используется для занятий с помощью инструктора. 

## Цели лаборатории

В этой лаборатории вы завершите следующее упражнение:

- Упражнение 1. Конечные точки службы и хранилище безопасности

## Схема конечных точек службы и защиты хранилища

![Схема, показывающая поток процессов задач в лаборатории.](../media/service-endpoints-and-securing-storage-diagram.png)

## Instructions

### Упражнение 1. Конечные точки службы и хранилище безопасности

### Предполагаемое время: 45 минут

В этом упражнении вы выполните следующие задачи.

- Задача 1. Создание виртуальной сети
- Задача 2. Добавление подсети в виртуальную сеть и настройка конечной точки хранилища
- Задача 3. Настройка группы безопасности сети для ограничения доступа к подсети
- Задача 4. Настройка группы безопасности сети для разрешения rdp в общедоступной подсети
- Задача 5. Создание учетной записи хранения с общей папкой
- Задача 6. Развертывание виртуальных машин в назначенных подсетях
- Задача 7. Проверьте подключение к хранилищу из частной подсети, чтобы убедиться, что доступ разрешен.
- Задача 8. Проверка подключения к хранилищу из общедоступной подсети, чтобы убедиться, что доступ запрещен. 

#### Задача 1. Создание виртуальной сети

В этой задаче вы создадите виртуальную сеть.

1. Войдите в портал Azure**`https://portal.azure.com/`**.

    >**Примечание.** Войдите в портал Azure с помощью учетной записи, которая имеет роль владельца или участника в подписке Azure, которую вы используете для этой лаборатории.

2. В портал Azure в текстовом поле "Поиск ресурсов, служб и документов" в верхней части страницы портал Azure введите ****виртуальные сети** и нажмите клавишу **ВВОД**.**

3. В колонке **виртуальная сеть s** нажмите кнопку " **Создать**".

4. **На вкладке "Основы**" колонки "Создание виртуальной **сети**" укажите следующие параметры (оставьте другие значения по умолчанию) и нажмите кнопку **Далее: IP-адреса**:

    |Параметр|Значение|
    |---|---|
    |Отток подписок|Имя подписки Azure, используемой в этой лаборатории|
    |Группа ресурсов|Нажмите кнопку **"Создать"** и введите имя **AZ500LAB12**|
    |Имя.|**myVirtualNetwork**|
    |Область/регион|**Восточная часть США (США)**|

5. На вкладке **IP-адресов** колонки "Создание виртуальной сети**" задайте адресное **пространство** IPv4 значение **10.0.0.0/16** в **столбце имени** подсети, щелкните значение по умолчанию** и в колонке "Изменить подсеть **" укажите следующие параметры и **нажмите **кнопку **"Сохранить**".**

    |Параметр|Значение|
    |---|---|
    |Имя подсети|**Открытый**|
    |Диапазон адресов подсети|**10.0.0.0/24**.|

6. Вернитесь на **вкладку **IP-адресов колонки** "Создать виртуальную сеть**", нажмите кнопку **"Просмотр и создание**".

7. На вкладке ****"Просмотр и создание**" колонки "Создать виртуальную сеть**" нажмите кнопку **"Создать**".

#### Задача 2. Добавление подсети в виртуальную сеть и настройка конечной точки хранилища

В этой задаче вы создадите другую подсеть и включите конечную точку службы в этой подсети. Конечные точки службы включены для каждой службы, для каждой подсети. 

1. В портал Azure вернитесь к колонке **виртуальная сеть.**

2. В колонке "Виртуальные **сети** " щелкните **запись myVirtualNetwork** .

3. В колонке myVirtualNetwork** в **разделе "Параметры**" щелкните **"Подсети****".

4. В колонке **подсетей** myVirtualNetwork \| щелкните +**Подсеть**. 

5. В колонке **"Добавление подсети** " укажите следующие параметры (оставьте остальных со значениями по умолчанию):

    |Параметр|Значение|
    |---|---|
    |Имя подсети|**Частное**|
    |Диапазон адресов подсети|**10.0.1.0/24**|
    |Конечные точки служб|**Оставьте значение по умолчанию none**|

6. В колонке **"Добавить подсеть** " нажмите кнопку **"Добавить**".

    >**Примечание**. Виртуальная сеть теперь имеет две подсети: общедоступную и частную. 
    
#### Задача 3. Настройка группы безопасности сети для ограничения доступа к подсети

В этой задаче вы создадите группу безопасности сети с двумя правилами безопасности исходящего трафика (хранилищем и Интернетом) и одним правилом безопасности для входящего трафика (RDP). Вы также свяжите группу безопасности сети с частной подсетью. Это приведет к ограничению исходящего трафика из виртуальных машин Azure, подключенных к этой подсети.

1. В портал Azure в текстовом поле "Поиск ресурсов, служб и документов" в верхней части страницы портал Azure введите ****группы** безопасности сети и нажмите **клавишу ВВОД**.**

2. В колонке **"Группы** безопасности сети" нажмите кнопку **"+ Создать**".

3. На вкладке ****"Основы" колонки "Создание группы** безопасности сети"** укажите следующие параметры: 

    |Параметр|Значение|
    |---|---|
    |Отток подписок|Имя подписки Azure, используемой в этой лаборатории|
    |Группа ресурсов|**AZ500LAB12**|
    |Имя.|**myNsgPrivate**|
    |Область/регион|**Восточная часть США**|

4. Щелкните **Просмотр и создание**, а затем нажмите кнопку **Создать**.

    >**Примечание.** В следующих шагах вы создадите правило безопасности для исходящего трафика, позволяющее обмен данными со службой служба хранилища Azure. 

5. В портал Azure перейдите к **колонке групп** безопасности сети и щелкните **запись myNsgPrivate**.

6. В колонке **myNsgPrivate** в **разделе "Параметры** " щелкните **"** Правила безопасности исходящего трафика".

7. В колонке **правил** безопасности для исходящего трафика myNsgPrivate \| нажмите кнопку **+Добавить**.

8. В колонке **"Добавление правила** безопасности для исходящего трафика" укажите следующие параметры, чтобы явным образом разрешить исходящий трафик служба хранилища Azure (оставьте все остальные значения своими параметрами по умолчанию): 

    |Параметр|Значение|
    |---|---|
    |Оригинал|**Тег службы**|
    |Тег службы источника|**VirtualNetwork**;|
    |Диапазоны исходных портов|**\***|
    |Назначение|**Тег службы**|
    |Назначение: тег службы|**Память**|
    |Диапазоны портов назначения|**\***|
    |Протокол|**Any**|
    |Действие|**Разрешить**|
    |Приоритет|**1000**|
    |Имя.|**Allow-Storage-All**|

9. В колонке **"Добавить правило** безопасности для исходящего трафика" нажмите кнопку **"Добавить** ", чтобы создать новое правило исходящего трафика. 

10. В колонке myNsgPrivate в разделе "Параметры **" щелкните **"** Правила безопасности исходящего трафика" и нажмите кнопку "**+Добавить**".**** **

11. В колонке **"Добавление правила** безопасности для исходящего трафика" укажите следующие параметры, чтобы явно запретить исходящий трафик в Интернет (оставьте все остальные значения своими параметрами по умолчанию): 

    |Параметр|Значение|
    |---|---|
    |Оригинал|**Тег службы**|
    |Тег службы источника|**VirtualNetwork**;|
    |Диапазоны исходных портов|**\***|
    |Назначение|**Тег службы**|
    |Назначение: тег службы|**Интернет**|
    |Диапазоны портов назначения|**\***|
    |Протокол|**Any**|
    |Действие|**Запретить**|
    |Приоритет|**1100**|
    |Имя.|**Deny-Internet-All**|

    >**Примечание.** Это правило переопределяет правило по умолчанию во всех группах безопасности сети, которые позволяют исходящему интернет-обмену данными. 

    >**Примечание.** В следующих шагах вы создадите правило безопасности для входящего трафика, разрешающее трафик протокола удаленного рабочего стола (RDP) в подсеть. Это правило переопределяет правило безопасности по умолчанию, запрещающее весь входящий трафик из Интернета. Подключения к удаленному рабочему столу разрешены к подсети, чтобы можно было проверить подключение на следующем шаге.

12. В колонке myNsgPrivate в разделе "Параметры **" щелкните **правила** безопасности для входящего трафика и нажмите кнопку **+Добавить**.**** **

13. В колонке **"Добавление правила** безопасности для входящего трафика" укажите следующие параметры (оставьте все остальные значения со значениями по умолчанию): 

    |Параметр|Значение|
    |---|---|
    |Оригинал|**Any**|
    |Диапазоны исходных портов|**\***|
    |Назначение|**Тег службы**|
    |Назначение: тег службы|**VirtualNetwork**;|
    |Диапазоны портов назначения|**3389**|
    |Протокол|**TCP**|
    |Действие|**Разрешить**|
    |Приоритет|**1200**|                                                    
    |Имя.|**Allow-RDP-All**|

14. В колонке **"Добавить правило** безопасности для входящего трафика" нажмите кнопку **"Добавить** ", чтобы создать новое правило для входящего трафика. 

    >**Примечание.** Теперь вы свяжите группу безопасности сети с частной подсетью.

15. В колонке **"Подсети"** выберите **+Связать** и укажите следующие параметры в **разделе "Связать подсеть** ", а затем нажмите кнопку **"ОК**".

    |Параметр|Значение|
    |---|---|
    |Виртуальная сеть|**myVirtualNetwork**|
    |Подсеть|**Частное**|

#### Задача 4. Настройка группы безопасности сети для разрешения rdp в общедоступной подсети

В этой задаче вы создадите группу безопасности сети с одним правилом безопасности для входящего трафика (RDP). Вы также свяжите группу безопасности сети с общедоступной подсетью. Это позволит RDP получить доступ к общедоступной виртуальной машине.

1. В портал Azure в текстовом поле "Поиск ресурсов, служб и документов" в верхней части страницы портал Azure введите ****группы** безопасности сети и нажмите **клавишу ВВОД**.**

2. В колонке **"Группы** безопасности сети" нажмите кнопку **"+ Создать**".

3. На вкладке ****"Основы" колонки "Создание группы** безопасности сети"** укажите следующие параметры: 

    |Параметр|Значение|
    |---|---|
    |Отток подписок|Имя подписки Azure, используемой в этой лаборатории|
    |Группа ресурсов|**AZ500LAB12**|
    |Имя.|**myNsgPublic**|
    |Область/регион|**Восточная часть США**|

4. Щелкните **Просмотр и создание**, а затем нажмите кнопку **Создать**.

    >**Примечание.** В следующих шагах вы создадите правило безопасности для исходящего трафика, позволяющее обмен данными со службой служба хранилища Azure. 

5. В портал Azure вернитесь в **колонку групп** безопасности сети и щелкните **запись myNsgPublic**.

6. В колонке myNsgPublic в разделе "Параметры **" щелкните **правила** безопасности для входящего трафика и нажмите кнопку **+Добавить**.**** **

7. В колонке **"Добавление правила** безопасности для входящего трафика" укажите следующие параметры (оставьте все остальные значения со значениями по умолчанию): 

    |Параметр|Значение|
    |---|---|
    |Оригинал|**Any**|
    |Диапазоны исходных портов|**\***|
    |Назначение|**Тег службы**|
    |Назначение: тег службы|**VirtualNetwork**;|
    |Диапазоны портов назначения|**3389**|
    |Протокол|**TCP**|
    |Действие|**Разрешить**|
    |Приоритет|**1200**|                                                    
    |Имя.|**Allow-RDP-All**|

8. В колонке **"Добавить правило** безопасности для входящего трафика" нажмите кнопку **"Добавить** ", чтобы создать новое правило для входящего трафика. 

    >**Примечание.** Теперь вы свяжите группу безопасности сети с общедоступной подсетью.

9. В колонке **"Подсети"** выберите **+Связать** и укажите следующие параметры в **разделе "Связать подсеть** ", а затем нажмите кнопку **"ОК**".

    |Параметр|Значение|
    |---|---|
    |Виртуальная сеть|**myVirtualNetwork**|
    |Подсеть|**Открытый**|
    
#### Задача 5. Создание учетной записи хранения с общей папкой

В этой задаче вы создадите учетную запись хранения с общей папкой и получите ключ учетной записи хранения.  

1. В портал Azure в текстовом поле "Поиск ресурсов, служб и документов **" в верхней части страницы** портал Azure введите **** учетные записи хранения и нажмите клавишу **ВВОД**.

2. В колонке **"Учетные** записи хранения" нажмите кнопку " **Создать**".

3. **На вкладке "Основные сведения"** колонки "Создание учетной **записи** хранения" укажите следующие параметры (оставьте остальных со значениями по умолчанию):

    |Параметр|Значение|
    |---|---|
    |Отток подписок|Имя подписки Azure, используемой в этой лаборатории|
    |Группа ресурсов|**AZ500LAB12**|
    |Storage account name|любое глобально уникальное имя от 3 до 24 длиной, состоящее из букв и цифр|
    |Расположение|**(США) EastUS**|
    |Производительность|**Стандартный (учетная запись общего назначения версии 2)**|
    |Избыточность|**Локально избыточное хранилище (LRS)**|

4. **На вкладке **"Основы**" колонки "Создать учетную запись** хранения" нажмите кнопку **"Просмотр и создание**", дождитесь завершения процесса проверки и нажмите кнопку **"Создать**".

    >**Примечание.** Дождитесь создания учетной записи хранения. Это займет около 2 минут.

5. В портал Azure в текстовом поле поиска, служб и документов в верхней части страницы портал Azure введите ****группы** ресурсов и нажмите клавишу **ВВОД**.**

6. В колонке **"Группы ресурсов" в списке групп** ресурсов щелкните **запись AZ500LAB12** .

7. В колонке **группы ресурсов AZ500LAB12** в списке ресурсов щелкните запись, представляющую только что созданную учетную запись хранения.

8. В колонке "Обзор** учетной записи **хранения" щелкните **"Общие папки"** на **вкладке хранилища** данных и нажмите кнопку **"+ Файловый ресурс**".

9. В колонке **"Создать общую** папку" снимите флажок **"Включить резервное копирование** " на вкладке "Резервное копирование". 

10. В колонке **"Создать общую папку** " укажите следующие параметры:

    |Параметр|Значение|
    |---|---|
    |Имя.|**my-file-share**|

11. В колонке **"Создать общую папку** " нажмите кнопку **"Создать**".

    >**Примечание.** Теперь получите и запишите скрипт PowerShell, который создает сопоставление дисков с общей папкой Azure. 

12. В колонке учетной записи хранения в списке общих папок щелкните **my-file-share**.

13. В колонке **"Мой файловый ресурс**" нажмите кнопку **"Подключить".**

14. **В колонке Connect** на **вкладке Windows** скопируйте сценарий PowerShell, который создает сопоставление дисков Z с общей папкой. 

    >**Примечание.** Запишите этот скрипт. Для сопоставления общей папки из виртуальной машины Azure в **частной** подсети вам потребуется позже в этой лаборатории.

15. Вернитесь к колонке учетной записи хранения, а затем в **разделе "Безопасность и сеть** " щелкните **"Сеть**".

16. В разделе **"Доступ к общедоступной сети"** выберите "Управление **" и **"Как действие** по умолчанию" выберите ****"Включить" из выбранных сетей**.

17. В разделе **"Параметры ресурса": виртуальные сети, IP-адреса и колонка исключений** , выберите **представление** и нажмите кнопку **+Добавить существующую ссылку виртуальной сети** . 

18. В колонке **"Добавление сетей** " укажите следующие параметры:

    |Параметр|Значение|
    |---|---|
    |Отток подписок|Имя подписки Azure, используемой в этой лаборатории|
    |Виртуальные сети|**myVirtualNetwork**|
    |подсети;|**Частное**|

19. В колонке **"Добавить сети** " нажмите кнопку **"Добавить**". 

20. Вернитесь в колонку учетной записи хранения и нажмите кнопку **"Сохранить**".

    >**Примечание.** На этом этапе в лаборатории вы настроили виртуальную сеть, группу безопасности сети и учетную запись хранения с общей папкой. 

#### Задача 6. Развертывание виртуальных машин в назначенных подсетях

В этой задаче вы создадите две виртуальные машины в частной подсети и одну в общедоступной подсети. 

>**Примечание**. Первая виртуальная машина будет подключена к частной подсети.

1. В портал Azure в текстовом поле "Поиск ресурсов, служб и документов" в верхней части страницы портал Azure введите ****"Виртуальные машины**" и нажмите клавишу **ВВОД**.**

2. В колонке "Виртуальные **машины** " нажмите кнопку **"+ Создать** " и в раскрывающемся списке щелкните **"Виртуальная машина"**

3. **На вкладке "Основные сведения**" колонки "Создание виртуальной **машины**" укажите следующие параметры (оставьте остальных со значениями по умолчанию):

    |Параметр|Значение|
    |---|---|
    |Отток подписок|Имя подписки Azure, используемой в этой лаборатории|
    |Группа ресурсов|**AZ500LAB12**|
    |Virtual machine name|**myVmPrivate**|
    |Область/регион|**(США)Восточная часть США**|
    |Изображения|**Центр обработки данных Windows Server 2022: Выпуск Azure — 2-е поколение**|
    |Имя пользователя|**Студент**|
    |Пароль|**Используйте личный пароль, созданный в лаборатории 02 > упражнении 2 > задаче 1 > шаге 3.**|
    |Общедоступные входящие порты|**Не допускается**|
    |У вас уже есть лицензия Windows Server|**Не выбрано**|

    >**Примечание.** Для общедоступных входящих портов мы будем полагаться на предварительно созданную группу безопасности сети. 

4. Нажмите кнопку **"Далее": диски >** и **на вкладке **"Диски**" колонки "Создание виртуальной машины**" задайте **для типа **** диска ОС значение "Стандартный hdD**" и нажмите кнопку **"Далее: сеть >**".

5. Нажмите кнопку **"Далее". Сетевые >** на **вкладке **"Сеть**" колонки "Создание виртуальной машины**" укажите следующие параметры (оставьте остальные со значениями по умолчанию):

    |Параметр|Значение|
    |---|---|
    |Виртуальная сеть|**myVirtualNetwork**|
    |Подсеть|**Private (10.0.1.0/24)** (Частная (10.0.1.0/24))|
    |Общедоступный IP-адрес|**(new)myVmPrivate-ip**|
    |Группа безопасности сети сетевого адаптера|**Не допускается**|

6. Нажмите кнопку **"Далее". Управление >**** на вкладке **"Управление**" колонки "Создание виртуальной машины**" примите параметры по умолчанию и нажмите кнопку **"Проверить и создать**".

7. В колонке **"Проверка и создание** " убедитесь, что проверка выполнена успешно и нажмите кнопку **"Создать**".

    >**Примечание.** Вторая виртуальная машина будет подключена к общедоступной подсети.

8. В колонке "Виртуальные машины" нажмите кнопку **"+ Добавить**" и в раскрывающемся списке щелкните **"Виртуальная машина**".** **

9. **На вкладке "Основные сведения**" колонки "Создание виртуальной **машины**" укажите следующие параметры (оставьте остальных со значениями по умолчанию):

    |Параметр|Значение|
    |---|---|
    |Отток подписок|Имя подписки Azure, используемой в этой лаборатории|
    |Группа ресурсов|**AZ500LAB12**|
    |Virtual machine name|**myVmPublic**|
    |Область/регион|**(США)Восточная часть США**|
    |Изображения|**Центр обработки данных Windows Server 2022: Выпуск Azure — 2-е поколение**|
    |Имя пользователя|**Студент**|
    |Пароль|**Используйте личный пароль, созданный в лаборатории 02 > упражнении 1 > задаче 1 > шаге 9.**|
    |Общедоступные входящие порты|**Не допускается**|
    |У вас уже есть лицензия Windows Server|**Не выбрано**|

    >**Примечание.** Для общедоступных входящих портов мы будем полагаться на предварительно созданную группу безопасности сети. 

10. Нажмите кнопку **"Далее": диски >** и **на вкладке **"Диски**" колонки "Создание виртуальной машины**" задайте **для типа **** диска ОС значение "Стандартный hdD**" и нажмите кнопку **"Далее: сеть >**".

11. Нажмите кнопку **"Далее". Сетевые >** на **вкладке **"Сеть**" колонки "Создание виртуальной машины**" укажите следующие параметры (оставьте остальные со значениями по умолчанию):

    |Параметр|Значение|
    |---|---|
    |Виртуальная сеть|**myVirtualNetwork**|
    |Подсеть|**Public (10.0.0.0/24)** (Общедоступная (10.0.0.0/24))|
    |Общедоступный IP-адрес|**(new)myVmPublic-ip**|
    |Группа безопасности сети сетевого адаптера|**Не допускается**|

12. Нажмите кнопку **"Далее". Управление >**** на вкладке **"Управление**" колонки "Создание виртуальной машины**" примите параметры по умолчанию и нажмите кнопку **"Проверить и создать**".

13. В колонке **"Проверка и создание** " убедитесь, что проверка выполнена успешно и нажмите кнопку **"Создать**".

    >**Примечание.** Вы можете продолжить следующую задачу после завершения развертывания виртуальной **машины MyVMPublic** Azure.

#### Задача 7. Проверьте подключение к хранилищу из частной подсети, чтобы убедиться, что доступ разрешен.

В этой задаче вы подключитесь к виртуальной машине myVMPrivate через удаленный рабочий стол и сопоставите диск с общей папкой. 

1. Вернитесь к колонке "Виртуальные **машины** ". 

2. В колонке "Виртуальные **машины** " щелкните **запись myVMPrivate** .

3. В колонке **myVMPrivate** нажмите кнопку **"Подключиться" и в раскрывающемся меню нажмите кнопку **"Подключить**".** 

4. Скачайте файл RDP и используйте его для подключения к виртуальной **машине Azure myVMPrivate** через удаленный рабочий стол. При появлении запроса на проверку подлинности укажите следующие учетные данные:

    |Параметр|Значение|
    |---|---|
    |Имя пользователя|**Студент**|
    |Пароль|**Используйте личный пароль, созданный в лаборатории 02 > упражнении 2 > задаче 1 > шаге 3.**|
     

    >**Примечание.** Дождитесь открытия и диспетчер сервера сеанса удаленного рабочего стола.

    >**Примечание.** Теперь вы будете сопоставлять диск Z с общей папкой Azure в сеансе удаленного рабочего стола с компьютером Windows Server 2022

5. В сеансе удаленного рабочего стола в **myVMPrivate** нажмите кнопку **"Пуск** ", а затем щелкните **isE** Windows PowerShell.

6. **В окне среды сценариев** Windows PowerShell откройте **область сценариев**, а затем вставьте и запустите скрипт PowerShell, записанный ранее в этой лаборатории. Сценарий имеет следующий формат:

    ```powershell
    $connectTestResult = Test-NetConnection -ComputerName <storage_account_name>.file.core.windows.net -Port 445
    if ($connectTestResult.TcpTestSucceeded) {
       # Save the password so the drive will persist on reboot
       cmd.exe /C "cmdkey /add:`"<storage_account_name>.file.core.windows.net`" /user:`"localhost\<storage_account_name>`"  /pass:`"<storage_account_key>`""
       # Mount the drive
       New-PSDrive -Name Z -PSProvider FileSystem -Root "\\<storage_account_name>.file.core.windows.net\my-file-share" -Persist
    } else {
       Write-Error -Message "Unable to reach the Azure storage account via port 445. Check to make sure your organization or ISP is not blocking port 445, or use Azure P2S VPN, Azure S2S VPN, or Express Route to tunnel SMB traffic over a different port."
    }
    ```
    >**Примечание**. Заполнитель `<storage_account_name>` представляет имя учетной записи хранения, включающей общую папку, и `<storage_account_key>` один его первичный ключ.

7. Запустите проводник и убедитесь, что сопоставление дисков Z успешно создано.

8. Затем в области консоли интегрированной **** консоли Windows PowerShell выполните следующую команду, чтобы убедиться, что виртуальная машина не имеет исходящего подключения к Интернету:

    ```powershell
    Test-NetConnection -ComputerName www.bing.com -Port 80
    ```

    >**Примечание**. Тест завершится ошибкой, так как группа безопасности сети, связанная с частной подсетью, не разрешает исходящий доступ к Интернету.

9. Завершите сеанс удаленного рабочего стола на виртуальной **машине Azure myVMPrivate** .

    >**Примечание.** На этом этапе вы подтвердили, что виртуальная машина в частной подсети может получить доступ к учетной записи хранения. 

####  Задача 8. Проверка подключения к хранилищу из общедоступной подсети, чтобы убедиться, что доступ запрещен. 

1. Вернитесь к колонке "Виртуальные **машины** ". 

2. В колонке "Виртуальные **машины** " щелкните **запись myVMPublic** .

3. В колонке **myVMPublic** нажмите кнопку "Подключиться **" и в раскрывающемся меню нажмите **кнопку **"Подключить".** 

4. Нажмите кнопку **"Подключиться через RDP** " и используйте ее для подключения к виртуальной **машине MyVMPublic** Azure через удаленный рабочий стол. При появлении запроса на проверку подлинности укажите следующие учетные данные:

    |Параметр|Значение|
    |---|---|
    |Имя пользователя|**Студент**|
    |Пароль|**Используйте личный пароль, созданный в лаборатории 02 > упражнении 2 > задаче 1 > шаге 3.**|


    >**Примечание.** Дождитесь открытия и диспетчер сервера сеанса удаленного рабочего стола.

    >**Примечание.** Теперь вы будете сопоставлять диск Z с общей папкой Azure в сеансе удаленного рабочего стола с компьютером Windows Server 2022

5. В сеансе удаленного рабочего стола в **myVMPublic** нажмите кнопку "Пуск **" и нажмите кнопку ****"Среда сценариев** Windows PowerShell".

6. **В окне сценариев** Windows PowerShell откройте **область сценариев**, а затем вставьте и выполните тот же скрипт PowerShell, который вы выполнили в сеансе удаленного рабочего стола, на **виртуальную машину Azure myVMPrivate**.

    >**Примечание**. На этот раз вы получите ошибку **New-PSDrive: доступ запрещен** . 

    >**Примечание.** Доступ запрещен, так как *виртуальная машина myVmPublic* развертывается в общедоступной подсети. Общедоступная подсеть не включает конечную точку службы для служба хранилища Azure. Учетная запись хранения разрешает доступ только к сети из частной подсети.

7. Затем в области консоли интегрированной **** консоли Windows PowerShell выполните следующую команду, чтобы убедиться, что виртуальная машина имеет исходящее подключение к Интернету: 

    ```powershell
    Test-NetConnection -ComputerName www.bing.com -Port 80
    ```

    >**Примечание**. Тест будет выполнен успешно, так как нет правила безопасности для исходящего трафика, чтобы запретить Интернет в общедоступной подсети.

8. Завершите сеанс удаленного рабочего стола на виртуальной **машине Azure myVMPublic** .

    >**Примечание.** На этом этапе вы подтвердили, что виртуальная машина в общедоступной подсети не может получить доступ к учетной записи хранения, но имеет доступ к Интернету.


**Очистка ресурсов**

> Не забудьте удалить все новые ресурсы Azure, которые больше не используются. Удаление неиспользуемых ресурсов гарантирует, что вы не будете нести непредвиденные затраты. 
