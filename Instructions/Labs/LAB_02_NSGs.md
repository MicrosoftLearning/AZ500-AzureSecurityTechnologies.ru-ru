---
lab:
  title: 02. Группы безопасности сети и группы безопасности приложений
  module: Module 01 - Plan and implement security for virtual networks
---

# Лаборатория 02. Группы безопасности сети и группы безопасности приложений
# Руководство по лаборатории учащихся

## Сценарий практической работы

Вам было предложено реализовать инфраструктуру виртуальной сети вашей организации и проверить, чтобы убедиться, что она работает правильно. В частности:

- В организации есть две группы серверов: веб-серверы и серверы управления.
- Каждая группа серверов должна находиться в собственной группе безопасности приложений. 
- Вы должны иметь возможность выполнять RDP на серверах управления, но не на веб-серверах.
- Веб-серверы должны отображать веб-страницу IIS при доступе из Интернета. 
- Правила группы безопасности сети должны использоваться для управления доступом к сети. 

> Для всех ресурсов в этой лаборатории мы используем **регион "Восточная часть США** ". Убедитесь, что этот регион используется для занятий с помощью инструктора. 

## Цели лаборатории

В этой лаборатории вы выполните следующие упражнения:

- Упражнение 1. Создание инфраструктуры виртуальной сети
- Упражнение 2. Развертывание виртуальных машин и проверка сетевых фильтров

## Схема групп безопасности сети и приложений

![Схема, показывающая поток процесса задач лаборатории.](../media/network-and-application-security-groups-diagram.png)

## Instructions

### Упражнение 1. Создание инфраструктуры виртуальной сети

### Предполагаемое время: 20 минут

> Для всех ресурсов в этой лаборатории мы используем **регион "Восточная часть США".** Убедитесь, что с инструктором это регион, используемый для вашего класса. 

В этом упражнении вы выполните следующие задачи.

- Задача 1. Создание виртуальной сети с одной подсетью.
- Задача 2. Создание двух групп безопасности приложений.
- Задача 3. Создайте группу безопасности сети и свяжите ее с подсетью виртуальной сети.
- Задача 4. Создание правил безопасности безопасности сети для всех трафика на веб-серверах и RDP на серверы управления.

#### Задача 1. Создание виртуальной сети

В этой задаче вы создадите виртуальную сеть для использования с группами безопасности сети и приложений. 

1. Войдите в портал Azure**`https://portal.azure.com/`**.

    >**Примечание.** Войдите в портал Azure с помощью учетной записи, которая имеет роль владельца или участника в подписке Azure, которую вы используете для этой лаборатории.

2. В портал Azure в текстовом поле "Поиск ресурсов, служб и документов" в верхней части страницы портал Azure введите **+++Virtual networks+++ и нажмите **клавишу ВВОД**.**

3. В колонке "Виртуальные **сети** " нажмите кнопку **"+ Создать**".

4. **На вкладке "Основы**" колонки "Создание виртуальной **сети**" укажите следующие параметры (оставьте другие значения по умолчанию) и нажмите кнопку **Далее: IP-адреса**:

    |Параметр|Значение|
    |---|---|
    |Отток подписок | Имя подписки Azure, используемой в этой лаборатории |
    |Группа ресурсов | Используйте указанную группу ресурсов с именем **AZ500LAB07** |
    |Имя.| +++myVirtualNetwork+++ |
    |Область/регион| **Восточная часть США** |

5. На вкладке **IP-адресов** колонки "Создание виртуальной сети**" задайте **для адресного пространства IPv4 значение** **10.0.0.0.0/16** и при необходимости в **столбце имени** подсети щелкните значение по умолчанию ****в колонке "Изменить подсеть**", укажите следующие параметры и нажмите кнопку ****"Сохранить**".**

    |Параметр|Значение|
    |---|---|
    |Имя подсети|**default**|
    |Диапазон адресов подсети|**10.0.0.0/24**.|

6. Вернитесь на **вкладку **IP-адресов** экрана "Создать виртуальную сеть**", нажмите кнопку **"Просмотр и создание**".

7. На вкладке ****"Просмотр и создание**" экрана "Создать виртуальную сеть**" нажмите кнопку **"Создать**".

#### Задача 2. Создание групп безопасности приложений

В этой задаче вы создадите группу безопасности приложений.

1. В портал Azure в **текстовом поле поиска, служб и документов в верхней части страницы** портал Azure введите +++Группы безопасности приложений+++ и нажмите **клавишу ВВОД**.

2. В колонке **групп** безопасности приложений нажмите кнопку **+Создать**.

3. **На вкладке **"Основы**" колонки "Создание группы** безопасности приложений" укажите следующие параметры: 

    |Параметр|Значение|
    |---|---|
    | Группа ресурсов | **AZ500LAB07** |
    | Имя. | +++myAsgWebServers+++ |
    | Область/регион | **Восточная часть США** |

    >**Примечание.** Эта группа будет использоваться для веб-серверов.

4. Щелкните **Просмотр и создание**, а затем нажмите кнопку **Создать**.

5. Вернитесь к колонке групп безопасности приложений **и нажмите кнопку **"Создать**".**

6. **На вкладке **"Основы**" колонки "Создание группы** безопасности приложений" укажите следующие параметры: 

    |Параметр|Значение|
    |---|---|
    |Группа ресурсов|**AZ500LAB07**|
    |Имя.| +++myAsgMgmtServers+++ |
    |Область/регион|**Восточная часть США**|

    >**Примечание**. Эта группа будет использоваться для серверов управления.

7. Щелкните **Просмотр и создание**, а затем нажмите кнопку **Создать**.

#### Задача 3. Создание группы безопасности сети и связывание группы безопасности сети с подсетью

В этой задаче вы создадите группу безопасности сети. 

1. В портал Azure в текстовом поле поиска, служб и документов в верхней части страницы** портал Azure введите **+++Группы безопасности сети+++ и нажмите **клавишу ВВОД**.

2. В колонке **"Группы** безопасности сети" нажмите кнопку **"+ Создать**".

3. На вкладке ****"Основы" колонки "Создание группы** безопасности сети"** укажите следующие параметры: 

    |Параметр|Значение|
    |---|---|
    | Отток подписок | Имя подписки Azure, используемой в этой лаборатории |
    | Группа ресурсов | **AZ500LAB07** |
    | Имя. | +++myNsg+++ |
    | Область/регион | **Восточная часть США** |

4. Щелкните **Просмотр и создание**, а затем нажмите кнопку **Создать**.

5. В портал Azure вернитесь в **колонку групп** безопасности сети и выберите **запись myNsg**. Или выберите **"Перейти к ресурсу** ", если он доступен.

6. В колонке myNsg в разделе "Параметры **" щелкните "Подсети **" и нажмите кнопку ****"+Связать**".**** ** 

7. В колонке **"Связать подсеть** " укажите следующие параметры и нажмите кнопку **"ОК**".

    |Параметр|Значение|
    |---|---|
    |Виртуальная сеть|**myVirtualNetwork**|
    |Подсеть|**default**|

#### Задача 4. Создание правил безопасности безопасности сети для всех трафика на веб-серверах и RDP на серверы. 

1. В колонке **myNsg** в **разделе "Параметры** " щелкните **правила** безопасности для входящего трафика.

2. Просмотрите правила безопасности по умолчанию и нажмите кнопку **+Добавить**.

3. В колонке **"Добавление правила** безопасности для входящего трафика" укажите следующие параметры, чтобы разрешить TCP-порты 80 и 443 группе **безопасности приложений MyAsgWebServers** (оставьте все остальные значения со значениями по умолчанию): 

    |Параметр|Значение|
    |---|---|
    | Оригинал | **Any** |
    | Диапазоны исходных портов | * |
    |Назначение|в раскрывающемся списке выберите **группу** безопасности приложений и щелкните **myAsgWebServers**|
    | Сервис | **Пользовательское** |
    |Диапазоны портов назначения|**80,443**|
    |Протокол|**TCP**|
    | Действие | **Разрешить** |
    |Приоритет|**100**|
    |Имя.|**Allow-Web-All**|

4. **Нажмите кнопку "Добавить" на **странице "Добавить** правило** безопасности для входящего трафика", чтобы создать новое правило для входящего трафика.

5. В колонке myNsg в разделе "Параметры **" щелкните **правила** безопасности для входящего трафика и нажмите кнопку +**Добавить**.**** **

6. В колонке **"Добавление правила** безопасности для входящего трафика" укажите следующие параметры, чтобы разрешить порт RDP (TCP 3389) группе **безопасности приложений MyAsgMgmtServers** (оставьте все остальные значения со значениями по умолчанию): 

    |Параметр|Значение|
    |---|---|
    | Оригинал | **Any** |
    | Диапазоны исходных портов | * |
    |Назначение|в раскрывающемся списке выберите **группу** безопасности приложений и выберите **myAsgMgmtServers**|
    | Сервис | **Пользовательское** |
    |Диапазоны портов назначения|**3389**|
    |Протокол|**TCP**|
    | Действие | **Разрешить** |
    |Приоритет|**110**|
    |Имя.|**Allow-RDP-All**|

7. Выберите "**Добавить" на **странице "Добавить** правило** безопасности для входящего трафика", чтобы создать новое правило для входящего трафика. 

> Результат. Вы развернули виртуальную сеть, сетевую безопасность с правилами безопасности для входящего трафика и две группы безопасности приложений. 

### Упражнение 2. Развертывание виртуальных машин и тестирование сетевых фильтров

### Предполагаемое время: 25 минут

В этом упражнении вы выполните следующие задачи.

- Задача 1. Создание виртуальной машины для использования в качестве веб-сервера.
- Задача 2. Создание виртуальной машины для использования в качестве сервера управления.
- Задача 3. Связывание каждого сетевого интерфейса виртуальных машин с группой безопасности приложений.
- Задача 4. Проверка фильтрации сетевого трафика.

#### Задача 1. Создание виртуальной машины для использования в качестве веб-сервера

В этой задаче вы создадите виртуальную машину для использования в качестве веб-сервера.

1. В портал Azure в **текстовом поле поиска, служб и документов в верхней части страницы** портал Azure введите +++Virtual machines+++ и нажмите **клавишу ВВОД**.

2. В колонке "Виртуальные машины" нажмите кнопку **"+ Создать**" и в раскрывающемся списке щелкните **"Виртуальная машина**".** **

3. **На вкладке "Основные сведения**" колонки "Создание виртуальной **машины**" укажите следующие параметры (оставьте остальных со значениями по умолчанию):

   |Параметр|Значение|
   |---|---|
   |Отток подписок|Имя подписки Azure, используемой в этой лаборатории|
   |Группа ресурсов|**AZ500LAB07**|
   |Virtual machine name|**myVmWeb**|
   |Область/регион|**(США)Восточная часть США**|
   |Параметры доступности|**Избыточность инфраструктуры не требуется**
   |Тип безопасности|**Стандартные**
   |Изображения|**Windows Server 2022 Datacenter: Выпуск Azure— x64-го поколения 2-го поколения**|
   |Размер|**Standard D2s v3**|
   |Имя пользователя|**Студент**|
   |Пароль|**Создайте собственный пароль и запишите его для последующей ссылки в последующих лабораториях**|
   |Подтверждение пароля|**Повторно введите пароль**|
   |Общедоступные входящие порты|**Не допускается**|
   |Хотите использовать существующую лицензию Windows Server? |**Нет**|

    >**Примечание.** Для общедоступных входящих портов мы будем полагаться на предварительно созданную группу безопасности сети. 

5. Нажмите кнопку **"Далее": диски >** и **на вкладке **"Диски**" колонки "Создание виртуальной машины**" задайте **для типа **** диска ОС значение "Стандартный hdD**" и нажмите кнопку **"Далее: сеть >**".

6. На вкладке **"Сеть"** колонки **"Создание виртуальной машины**" выберите созданную ранее сеть **myVirtualNetwork** и **подсеть по умолчанию (10.0.0.0.0/24).**

7. В группе **** безопасности сети сетевого адаптера выберите **None**.

8. Нажмите кнопку **"Далее": >** управления, а затем нажмите кнопку **"Далее: мониторинг >**". На вкладке **"Мониторинг** " колонки "Создание виртуальной **машины** " проверьте следующий параметр:

   |Параметр|Значение|
   |---|---|
   |Диагностика загрузки|**Включена с помощью управляемой учетной записи хранения (рекомендуется)**|

9. Нажмите кнопку **"Просмотр и создание**" в колонке **"Проверка и создание** ", убедитесь, что проверка выполнена успешно и нажмите кнопку **"Создать**".

#### Задача 2. Создание виртуальной машины для использования в качестве сервера управления. 

В этой задаче вы создадите виртуальную машину для использования в качестве сервера управления.

1. В портал Azure вернитесь в **колонку "Виртуальные машины**", нажмите кнопку "**Создать**" и в раскрывающемся списке щелкните **"Виртуальная машина**".

2. **На вкладке "Основные сведения**" колонки "Создание виртуальной **машины**" укажите следующие параметры (оставьте остальных со значениями по умолчанию):

   |Параметр|Значение|
   |---|---|
   |Отток подписок|Имя подписки Azure, используемой в этой лаборатории|
   |Группа ресурсов|**AZ500LAB07**|
   |Virtual machine name|**myVMMgmt**|
   |Область/регион|(США)Восточная часть США|
   |Параметры доступности|**Избыточность инфраструктуры не требуется**
   |Тип безопасности|**Стандартные**
   |Изображения|**Центр обработки данных Windows Server 2022: Выпуск Azure — x64-го поколения 2-го поколения**|
   |Размер|**Standard D2s v3**|
   |Имя пользователя|**Студент**|
   |Пароль|**Используйте личный пароль, созданный в лаборатории 02 > упражнении 2 > задаче 1 > шаге 3.**|
   |Общедоступные входящие порты|**Не допускается**|
   |У вас уже есть лицензия Windows Server|**Нет**|

    >**Примечание.** Для общедоступных входящих портов мы будем полагаться на предварительно созданную группу безопасности сети. 

4. Нажмите кнопку **"Далее": диски >** и **на вкладке **"Диски**" колонки "Создание виртуальной машины**" задайте **для типа **** диска ОС значение "Стандартный hdD**" и нажмите кнопку **"Далее: сеть >**".

5. На вкладке **"Сеть"** колонки **"Создание виртуальной машины**" выберите созданную ранее сеть **myVirtualNetwork** и **подсеть по умолчанию (10.0.0.0.0/24).**

6. В группе **** безопасности сети сетевого адаптера выберите **None**.

7. Нажмите кнопку **"Далее": >** управления, а затем нажмите кнопку **"Далее: мониторинг >**". На вкладке **"Мониторинг** " колонки "Создание виртуальной **машины** " проверьте следующий параметр:

   |Параметр|Значение|
   |---|---|
   |Диагностика загрузки|**Включена с помощью управляемой учетной записи хранения (рекомендуется)**|

8. Нажмите кнопку **"Просмотр и создание**" в колонке **"Проверка и создание** ", убедитесь, что проверка выполнена успешно и нажмите кнопку **"Создать**".

    >**Примечание.** Дождитесь подготовки обеих виртуальных машин перед продолжением. 

#### Задача 3. Связывание сетевого интерфейса каждой виртуальной машины с группой безопасности приложений.

В этой задаче вы свяжите каждый сетевой интерфейс виртуальных машин с соответствующей группой безопасности приложений. Интерфейс виртуальной машины myVMWeb будет связан с asG myAsgWebServers. Интерфейс виртуальной машины myVMMgmt будет связан с asG myAsgMgmtServers. 

1. В портал Azure вернитесь к **колонке "Виртуальные машины**" и убедитесь, что обе виртуальные машины перечислены с состоянием **"Выполнение**".

2. В списке виртуальных машин щелкните **запись myVMWeb** .

3. В колонке myVMWeb в разделе "Сеть **" выберите **параметры** сети, а затем в **колонке параметров** сети myVMWeb \| щелкните **вкладку "Группы** безопасности приложений".**** **

4. Нажмите кнопку "**+ Добавить группы безопасности приложений" в списке **групп**** безопасности приложений, выберите **myAsgWebServers** и нажмите кнопку **"Сохранить**".

5. Вернитесь к колонке **"Виртуальные машины** " и в списке виртуальных машин щелкните **запись myVMMgmt** .

6. В колонке myVMMgmt** в **разделе "Сеть**" выберите **параметры** сети, а затем в **колонке параметров** сети myVMMgmt \| щелкните **вкладку "Группы** безопасности приложений**".

7. Щелкните +**Добавить группы безопасности приложений в списке **групп**** безопасности приложений, выберите **myAsgMgmtServers** и нажмите кнопку **"Добавить**".

#### Задача 4. Проверка фильтрации сетевого трафика

В этой задаче вы протестируете фильтры сетевого трафика. Вы должны иметь возможность RDP в виртуальную машину myVMMgmnt. Вы должны иметь возможность подключаться из Интернета к виртуальной машине myVMWeb и просматривать веб-страницу IIS по умолчанию.  

1. Вернитесь к колонке виртуальной **машины myVMMgmt** .

2. В колонке **обзора myVMMgmt** нажмите кнопку **"Подключиться" и в раскрывающемся меню нажмите кнопку **"Подключить**".** 

3. Скачайте файл RDP и используйте его для подключения к виртуальной **машине MyVMMgmt** Azure через удаленный рабочий стол. При появлении запроса на проверку подлинности укажите следующие учетные данные:

   |Параметр|Значение|
   |---|---|
   |User name|**Студент**|
   |Пароль|**Используйте личный пароль, созданный в лаборатории 02 > упражнении 1 > задаче 1 > шаге 9.**|

    >**Примечание.** Убедитесь, что подключение к удаленному рабочему столу выполнено успешно. На этом этапе вы подтвердили, что вы можете подключиться через удаленный рабочий стол к myVMMgmt.

4. В портал Azure перейдите к колонке виртуальной **машины myVMWeb**.

5. В колонке myVMWeb** в **разделе "Операции**" щелкните **команду** "Выполнить", а затем нажмите кнопку **RunPowerShellScript****.

6. **На панели "Запуск командного скрипта**" выполните следующую команду, чтобы установить роль веб-сервера в **myVmWeb**:

    ```powershell
    Install-WindowsFeature -name Web-Server -IncludeManagementTools
    ```

    >**Примечание.** Дождитесь завершения установки. Это может занять несколько минут. На этом этапе можно убедиться, что myVMWeb можно получить через HTTP/HTTPS.

7. В портал Azure вернитесь к колонке **myVMWeb**.

8. В колонке **myVMWeb** определите **общедоступный IP-адрес** виртуальной машины MyVmWeb Azure.

9. Откройте другую вкладку браузера и перейдите к IP-адресу, определенному на предыдущем шаге.

    >**Примечание.** Страница браузера должна отображать страницу приветствия IIS по умолчанию, так как порт 80 разрешен входящий трафик из Интернета на основе параметра **группы безопасности приложений myAsgWebServers** . Сетевой интерфейс виртуальной машины Azure myVMWeb связан с этой группой безопасности приложений. 

> Результат. Вы проверили, работает ли конфигурация NSG и ASG, и трафик управляется правильно. 

**Очистка ресурсов**

> Не забудьте удалить все новые ресурсы Azure, которые больше не используются. Удаление неиспользуемых ресурсов гарантирует, что вы не будете нести непредвиденные затраты. 

1. Откройте Cloud Shell, щелкнув первый значок в правом верхнем углу портала Azure. Если появится запрос, выберите **PowerShell** и **Нет необходимой** учетной записи хранения, выберите имя подписки и нажмите кнопку **"Применить**".

2. Убедитесь, что **PowerShell** выбран в раскрывающемся меню в левом верхнем углу панели Cloud Shell.

3. В сеансе PowerShell в области Cloud Shell выполните следующие действия, чтобы удалить группу ресурсов, созданную в этой лаборатории:
  
    ```powershell
    Remove-AzResourceGroup -Name "AZ500LAB07" -Force -AsJob
    ```

4.  Закройте область **Cloud Shell**. 
