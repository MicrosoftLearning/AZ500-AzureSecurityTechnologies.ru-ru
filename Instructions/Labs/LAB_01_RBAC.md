---
lab:
  title: 01. Контроль доступа на основе ролей
  module: Module 01 - Manage Identity and Access
---


# Лаборатория 01: контроль доступа на основе ролей
# Руководство по лаборатории учащихся

## Сценарий практической работы

Вам было предложено создать доказательство концепции, показывающую, как создаются пользователи и группы Azure. Кроме того, как управление доступом на основе ролей используется для назначения ролей группам. В частности, необходимо:

- Создайте группу старших администраторов, содержащую учетную запись пользователя Джозефа Прайса в качестве члена.
- Создайте группу младших администраторов, содержащую учетную запись пользователя Isabel Garcia в качестве члена.
- Создайте группу Service Desk, содержащую учетную запись пользователя Дилан Уильямса в качестве члена.
- Назначьте роль участника виртуальной машины группе Service Desk. 

> Для всех ресурсов в этой лаборатории мы используем **регион "Восточная часть США** ". Убедитесь, что этот регион используется для занятий с помощью инструктора. 

## Цели лаборатории

В этой лаборатории вы выполните следующие упражнения:

- Упражнение 1. Создание группы старших администраторов с учетной записью пользователя Джозеф Прайс в качестве члена (портал Azure). 
- Упражнение 2. Создание группы младших администраторов с учетной записью пользователя Isabel Garcia в качестве члена (PowerShell).
- Упражнение 3. Создание группы Service Desk с пользователем Дилан Уильямс в качестве члена (Azure CLI). 
- Упражнение 4. Назначение роли участника виртуальной машины группе Service Desk.

## Схема архитектуры на основе ролей контроль доступа

![Схема с макетом системы для этой лаборатории и процессом лабораторий](../media/role-based-access-control-architecture-diagram.png)

## Instructions

### Упражнение 1. Создайте группу старших администраторов с учетной записью пользователя Джозеф Прайс в качестве члена. 

#### Предполагаемое время: 10 минут

В этом упражнении вы выполните следующие задачи.

- Задача 1. Использование портал Azure для создания учетной записи пользователя для Джозеф Прайс.
- Задача 2. Используйте портал Azure для создания группы старших администраторов и добавления учетной записи пользователя Джозефа Прайса в группу.

#### Задача 1. Использование портал Azure для создания учетной записи пользователя для Джозеф Прайс 

В этой задаче вы создадите учетную запись пользователя для Джозеф Прайс. 

1. Запустите сеанс браузера и войдите в портал Azure**`https://portal.azure.com/`**.

    >**Примечание**. Войдите в портал Azure с помощью учетной записи, которая имеет роль владельца или участника в подписке Azure, которую вы используете для этой лаборатории, и роль глобального администратора в клиенте Microsoft Entra, связанном с этой подпиской.

2. **В текстовом поле "Поиск ресурсов, служб и документов" в верхней части страницы** портал Azure введите **идентификатор** Microsoft Entra и нажмите **клавишу ВВОД**.

3. В колонке "Обзор **" клиента идентификатора Microsoft Entra в **разделе "Управление**" выберите **"Пользователи**" и нажмите кнопку **"Создать пользователя**".**

4. В колонке **"Новый пользователь" убедитесь, что **выбран параметр "Создать пользователя****" и укажите следующие параметры:

   |Параметр|Значение|
   |---|---|
   |User name|**Иосиф**|
   |Имя.|**Джозеф Прайс**|

5. Щелкните значок копирования рядом с **именем** пользователя, чтобы скопировать полного пользователя.

6. Убедитесь, что **выбран пароль автоматического создания** , установите **флажок "Показать пароль** ", чтобы определить автоматически созданный пароль. Необходимо указать этот пароль вместе с именем пользователя в Джозефе. 

7. Нажмите кнопку **Создать**.

8. Обновление пользователей **| Все пользователи** , чтобы убедиться, что новый пользователь был создан в клиенте Microsoft Entra.

#### Задача2. Используйте портал Azure для создания группы старших администраторов и добавления учетной записи пользователя Джозефа Прайса в группу.

В этой задаче вы создадите *группу старших администраторов* , добавьте учетную запись пользователя Джозефа Прайса в группу и настройте ее в качестве владельца группы.

1. В портал Azure вернитесь к колонке, отображающей клиент Идентификатора Microsoft Entra. 

2. **В разделе "Управление"** щелкните "Группы **" и нажмите **кнопку **"+ Создать группу**".
 
3. В колонке **"Новая группа"** укажите следующие параметры (оставьте остальных со значениями по умолчанию):

   |Параметр|Значение|
   |---|---|
   |Group type|**Безопасность**|
   |Имя группы|**Старшие администраторы**|
   |Тип членства|**Назначенные**|
    
4. **Щелкните ссылку "Нет владельцев"** в колонке **"Добавить владельцев**", выберите **Джозеф Прайс** и нажмите кнопку **"Выбрать**".

5. **Щелкните ссылку "Нет участников"**, в колонке **"Добавить элементы**" выберите **Джозеф Прайс** и нажмите кнопку **"Выбрать**".

6. Вернитесь в колонку **"Создать группу** ", нажмите кнопку **"Создать**".

> Результат. Вы использовали портал Azure для создания пользователя и группы и назначали пользователю группу. 

### Упражнение 2. Создание группы младших администраторов, содержащей учетную запись пользователя Isabel Garcia в качестве члена.

#### Предполагаемое время: 10 минут

В этом упражнении вы выполните следующие задачи.

- Задача 1. Создание учетной записи пользователя для Isabel Garcia с помощью PowerShell.
- Задача 2. Создание группы младших администраторов и добавление учетной записи пользователя Isabel Garcia в группу с помощью PowerShell. 

#### Задача 1. Создание учетной записи пользователя для Isabel Garcia с помощью PowerShell.

В этой задаче вы создадите учетную запись пользователя для Isabel Garcia с помощью PowerShell.

1. **Откройте Cloud Shell, щелкнув **значок** Cloud Shell** в правом верхнем углу портал Azure.

2. Если появится запрос, выберите **"Не требуется** учетная запись хранения", выберите имя подписки и нажмите кнопку **"Применить**". Это необходимо *только при* первом запуске Cloud Shell.

3. В области Cloud Shell убедитесь, **что PowerShell выбран** в раскрывающемся меню в верхнем левом углу. (Примечание. В новом Cloud Shell это будет говорить: **-->Switch на Bash**)

   >**Примечание.** Чтобы вставить скопированный текст в Cloud Shell, щелкните правой кнопкой мыши в окне панели и выберите " **Вставить**". Кроме того, можно использовать **сочетание клавиш SHIFT+INSERT** .

4. В сеансе PowerShell в области Cloud Shell выполните следующие действия, чтобы создать объект профиля пароля:

    ```powershell
    $passwordProfile = New-Object -TypeName Microsoft.Open.AzureAD.Model.PasswordProfile
    ```

5. В сеансе PowerShell в области Cloud Shell выполните следующие действия, чтобы задать значение пароля в объекте профиля:
    ```powershell
    $passwordProfile.Password = "Pa55w.rd1234"
    ```

6. В сеансе PowerShell в области Cloud Shell выполните следующее, чтобы подключиться к идентификатору Microsoft Entra:

    ```powershell
    Connect-AzureAD
    ```
      
7. В сеансе PowerShell в области Cloud Shell выполните следующие действия, чтобы определить имя клиента Microsoft Entra: 

    ```powershell
    $domainName = ((Get-AzureAdTenantDetail).VerifiedDomains)[0].Name
    ```

8. В сеансе PowerShell в области Cloud Shell выполните следующую команду, чтобы создать учетную запись пользователя для Isabel Garcia: 

    ```powershell
    New-AzureADUser -DisplayName 'Isabel Garcia' -PasswordProfile $passwordProfile -UserPrincipalName "Isabel@$domainName" -AccountEnabled $true -MailNickName 'Isabel'
    ```

9. В сеансе PowerShell в области Cloud Shell выполните следующие действия, чтобы получить список пользователей Идентификатора Microsoft Entra (учетные записи Джозефа и Isabel должны отображаться в списке): 

    ```powershell
    Get-AzureADUser -All $true | Where-Object {$_.UserPrincipalName -like "*43846135@LOD*"} 
    ```

#### Задача2. Используйте PowerShell для создания группы младших администраторов и добавления учетной записи пользователя Isabel Garcia в группу.

В этой задаче вы создадите группу "Младшие администраторы" и добавьте учетную запись пользователя Isabel Garcia в группу с помощью PowerShell.

1. В том же сеансе PowerShell в области Cloud Shell выполните следующую команду, чтобы **создать новую группу** безопасности с именем младших администраторов:
   
   ```powershell
   New-AzureADGroup -DisplayName 'Junior Admins43846135' -MailEnabled $false -SecurityEnabled $true -MailNickName JuniorAdmins
   ```
   
2. В сеансе PowerShell в области Cloud Shell выполните следующие действия, чтобы **получить список групп в клиенте Microsoft Entra (список должен включать группы** старших администраторов и младших администраторов).
   
   ```powershell
   Get-AzureADGroup
   ```

3. В сеансе PowerShell в области Cloud Shell выполните следующую команду, чтобы **получить ссылку на** учетную запись пользователя Isabel Garcia:

   ```powershell
   $user = Get-AzureADUser -Filter "UserPrincipalName eq 'Isabel-43846135@LODSPRODMCA.onmicrosoft.com'"
   ```

4. В сеансе PowerShell в области Cloud Shell выполните следующую команду, чтобы добавить учетную запись пользователя Isabel в группу Junior Admins43846135:
   ```powershell
   Add-AzADGroupMember -MemberUserPrincipalName $user.userPrincipalName -TargetGroupDisplayName "Junior Admins43846135"
   ```

5. В сеансе PowerShell в области Cloud Shell выполните следующую команду, чтобы убедиться, что группа младших администраторов43846135 содержит учетную запись пользователя Isabel:
   
   ```powershell
    Get-AzADGroupMember -GroupDisplayName "Junior Admins43846135"
    ```
   
> Результат. Вы использовали PowerShell для создания пользователя и учетной записи группы и добавили учетную запись пользователя в учетную запись группы. 

### Упражнение 3. Создайте группу Service Desk, содержащую учетную запись пользователя Дилан Уильямса в качестве члена.

#### Предполагаемое время: 10 минут

В этом упражнении вы выполните следующие задачи.

- Задача 1. Создание учетной записи пользователя для Дилана Уильямса с помощью Azure CLI.
- Задача 2. Создание группы Service Desk и добавление учетной записи пользователя Dylan в группу с помощью Azure CLI. 

#### Задача 1. Создание учетной записи пользователя для Дилана Уильямса с помощью Azure CLI.

В этой задаче вы создадите учетную запись пользователя для Дилан Уильямс.

1. В раскрывающемся меню в левом верхнем углу области Cloud Shell выберите **Bash (или: **Переключитесь на Bash****) и при появлении запроса нажмите кнопку **"Подтвердить**". 

2. В сеансе Bash в области Cloud Shell выполните следующие действия, чтобы определить имя клиента Microsoft Entra:

    ```cli
    DOMAINNAME=$(az ad signed-in-user show --query 'userPrincipalName' | cut -d '@' -f 2 | sed 's/\"//')
    ```

3. В сеансе Bash в области Cloud Shell выполните следующую команду, чтобы создать пользователя Дилан Уильямс. Используйте *ваш домен*.
 
    ```cli
    az ad user create --display-name "Dylan Williams" --password "Pa55w.rd1234" --user-principal-name Dylan@$DOMAINNAME
    ```
      
4. В сеансе Bash в области Cloud Shell выполните следующие действия, чтобы получить список учетных записей пользователей Идентификатора Microsoft (список должен включать учетные записи пользователей Джозефа, Isabel и Dylan).
    
    ```cli
    az ad user list --output table
    ```

#### Задача 2. Создание группы Service Desk и добавление учетной записи пользователя Dylan в группу с помощью Azure CLI. 

В этой задаче вы создадите группу Service Desk и назначите Дилан группе. 

1. В том же сеансе Bash в области Cloud Shell выполните следующую команду, чтобы создать новую группу безопасности с именем Service Desk.

    ```cli
    az ad group create --display-name "Service Desk" --mail-nickname "ServiceDesk"
    ```
 
2. В сеансе Bash в области Cloud Shell выполните следующую команду, чтобы получить список групп идентификаторов Microsoft Entra (список должен включать службу Service Desk, старшие администраторы и группы младших администраторов):

    ```cli
    az ad group list -o table
    ```

3. В сеансе Bash в области Cloud Shell выполните следующую команду, чтобы получить ссылку на учетную запись пользователя Dylan Williams: 

    ```cli
    USER=$(az ad user list --filter "displayname eq 'Dylan Williams'")
    ```

4. В сеансе Bash в области Cloud Shell выполните следующее, чтобы получить свойство objectId учетной записи пользователя Dylan Williams: 

    ```cli
    OBJECTID=$(echo $USER | jq '.[].id' | tr -d '"')
    ```

5. В сеансе Bash в области Cloud Shell выполните следующую команду, чтобы добавить учетную запись пользователя Dylan в группу Service Desk: 

    ```cli
    az ad group member add --group "Service Desk" --member-id $OBJECTID
    ```

6. В сеансе Bash в области Cloud Shell выполните следующую команду, чтобы получить список участников группы Service Desk и убедиться, что она включает учетную запись пользователя Dylan:

    ```cli
    az ad group member list --group "Service Desk"
    ```

7. Закройте область Cloud Shell.

> Результат. С помощью Azure CLI вы создали пользователя и учетные записи группы и добавили учетную запись пользователя в группу. 


### Упражнение 4. Назначение роли участника виртуальной машины группе Service Desk.

#### Предполагаемое время: 10 минут

В этом упражнении вы выполните следующие задачи.

- Задача 1. Создание группы ресурсов. 
- Задача 2. Назначение разрешений участника виртуальной машины службы группе ресурсов.  

#### Задача 1. Создание группы ресурсов

1. В портал Azure в текстовом поле поиска, служб и документов в верхней части страницы портал Azure введите ****группы** ресурсов и нажмите клавишу **ВВОД**.**

2. В колонке **"Группы** ресурсов" нажмите кнопку **"+ Создать** " и укажите следующие параметры:

   |Параметр|Значение|
   |---|---|
   |Название подписки|имя подписки Azure|
   |Имя группы ресурсов|**AZ500Lab01**|
   |Расположение|**Восточная часть США**|

3. Щелкните элемент **Просмотр и создание**, а затем — команду **Создать**.

   >**Примечание.** Дождитесь развертывания группы ресурсов. **Используйте значок уведомления** (в правом верхнем углу) для отслеживания хода выполнения состояния развертывания.

4. Вернитесь в **колонку "Группы** ресурсов", обновите страницу и убедитесь, что новая группа ресурсов появится в списке групп ресурсов.


#### Задача 2. Назначение разрешений участника виртуальной машины Service Desk. 

1. В колонке "Группы** ресурсов" щелкните **запись группы ресурсов AZ500LAB01**.**

2. В колонке **AZ500Lab01** щелкните **элемент управления доступом (IAM)** в средней области.

3. В колонке управления доступом **AZ500Lab01 \| (IAM)** нажмите кнопку **+Добавить** , а затем в раскрывающемся меню нажмите кнопку **"Добавить назначение** ролей".

4. В колонке **"Добавить назначение** ролей" заполните все следующие параметры перед нажатием кнопки "Далее".

   **Примечание.** После выполнения всех действий нажмите кнопку **"Далее**".

   |Параметр|Значение|
   |---|---|
   |Роль на вкладке поиска|**Участник виртуальной машины**|
   |Назначение доступа (в области элементов)|**Пользователь, группа или субъект-служба**.|
   |Выберите (+Выбрать участников)|**Служба "Служба"**|

6. Нажмите кнопку "Рецензирование" и дважды назначьте **** ее, чтобы создать назначение роли.

7. В колонке управления доступом **(IAM)** выберите **назначения** ролей.

8. В колонке управления доступом AZ500Lab01 \| (IAM) на вкладке **"Проверка доступа**" в текстовом поле "Поиск по имени" или "Адрес** электронной почты"** введите ****Дилан Уильямс**.**

9. В списке результатов поиска выберите учетную запись пользователя Dylan Williams и в **колонке "Dylan Williams" ( AZ500Lab01** ) просмотрите только что созданное назначение.

10. Закройте колонку **"Дилан Уильямс" — AZ500Lab01** .

11. Повторите те же два шага, чтобы проверить доступ к **Джозеф Прайс**. 

> Результат. Вы назначили и проверили разрешения RBAC. 

**Очистка ресурсов**

> Не забудьте удалить все новые ресурсы Azure, которые больше не используются. Удаление неиспользуемых ресурсов гарантирует, что вы не будете нести непредвиденные затраты.

1. В портал Azure откройте Cloud Shell, щелкнув первый значок в правом верхнем углу портала Azure. 

2. В раскрывающемся меню в левом верхнем углу области Cloud Shell выберите **PowerShell** и при появлении запроса нажмите кнопку **"Подтвердить**". 

3. В сеансе PowerShell в области Cloud Shell выполните следующие действия, чтобы удалить группу ресурсов, созданную в этой лаборатории:
  
    ```
    Remove-AzResourceGroup -Name "AZ500LAB01" -Force -AsJob
    ```

4.  Закройте область **Cloud Shell**. 
